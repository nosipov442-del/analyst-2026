import streamlit as st
import google.generativeai as genai
from datetime import datetime

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.set_page_config(page_title="Gemini 3 Real-Time Analyst", page_icon="‚öΩ", layout="wide")

# –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
today_date = datetime.now().strftime("%d.%m.%Y")

st.title("‚öΩ –ê–Ω–∞–ª–∏—Ç–∏–∫ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏")
st.write(f"–†–µ–∂–∏–º: **Google Search Grounding** | –°–µ–≥–æ–¥–Ω—è: {today_date}")

with st.sidebar:
    api_key = st.text_input("–í–≤–µ–¥–∏—Ç–µ Google API Key", type="password")
    st.divider()
    st.warning("–í–ù–ò–ú–ê–ù–ò–ï: –ú–æ–¥–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –≤ —Å–µ—Ç–∏ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.")

match_input = st.text_input("–í–≤–µ–¥–∏—Ç–µ –º–∞—Ç—á (–Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏–ª–∏ –∑–∞–≤—Ç—Ä–∞):")

if st.button("üöÄ –ü–û–õ–£–ß–ò–¢–¨ –ê–ö–¢–£–ê–õ–¨–ù–´–ô –ü–†–û–ì–ù–û–ó"):
    if not api_key:
        st.error("–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á!")
    elif not match_input:
        st.warning("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç—á–∞.")
    else:
        try:
            genai.configure(api_key=api_key)
            
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: –í–ö–õ–Æ–ß–ê–ï–ú –ü–û–ò–°–ö GOOGLE
            # –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–∏—Ç –º–æ–¥–µ–ª—å –≤—ã–π—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º
            tools = [
                {'google_search_retrieval': {}}
            ]

            model = genai.GenerativeModel(
                model_name='gemini-3-flash-preview',
                tools=tools # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–∏—Å–∫–∞ —Å—é–¥–∞
            )
            
            with st.spinner(f'–í—ã–ø–æ–ª–Ω—è—é –ø–æ–∏—Å–∫ –≤ Google –ø–æ –∑–∞–ø—Ä–æ—Å—É "{match_input}"...'):
                # –§–æ—Ä–º–∏—Ä—É–µ–º –∂–µ—Å—Ç–∫–∏–π –ø—Ä–æ–º–ø—Ç
                query = (
                    f"–°–µ–≥–æ–¥–Ω—è {today_date}. –ò—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç google_search, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ "
                    f"—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–∞—Ç—á–µ–π, —Ç–µ–∫—É—â–∏–µ —Ç—Ä–∞–≤–º—ã –∏ –Ω–æ–≤–æ—Å—Ç–∏ –æ –∫–æ–º–∞–Ω–¥–∞—Ö –≤ –º–∞—Ç—á–µ {match_input}. "
                    f"–ó–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–Ω–∞–Ω–∏—è –¥–æ 2024 –≥–æ–¥–∞. "
                    f"–î–∞–π –ø—Ä–æ–≥–Ω–æ–∑ —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é —è–Ω–≤–∞—Ä—è 2026 –≥–æ–¥–∞. "
                    f"–í—ã–¥–∞–π: 1. –°–æ—Å—Ç–∞–≤—ã. 2. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ %. 3. –ü—Ä–æ–≥–Ω–æ–∑ —Å—á–µ—Ç–∞. 4. –°—Ç–∞–≤–∫–∞ –¥–Ω—è."
                )
                
                # –ó–∞–ø—Ä–æ—Å (–æ–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ, –∑–¥–µ—Å—å –Ω–µ –Ω—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å generation_config –≤–Ω—É—Ç—Ä–∏ –≤—ã–∑–æ–≤–∞, –µ—Å–ª–∏ –æ–Ω –≤ –º–æ–¥–µ–ª–∏)
                response = model.generate_content(query)
                
                st.markdown("---")
                
                # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ (–µ—Å–ª–∏ –º–æ–¥–µ–ª—å –∏—Ö –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç)
                if response.candidates[0].grounding_metadata.search_entry_point:
                    st.info("–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≤–µ–¥–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ Google.")
                
                st.markdown(response.text)
                
        except Exception as e:
            st.error(f"–û—à–∏–±–∫–∞: {str(e)}")
            st.info("–ï—Å–ª–∏ –≤–∞—à–∞ –≤–µ—Ä—Å–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç tools, –æ–±–Ω–æ–≤–∏—Ç–µ –µ—ë: pip install -U google-generativeai")

