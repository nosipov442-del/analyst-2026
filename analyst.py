import streamlit as st
import google.generativeai as genai
from datetime import datetime

# --- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ---
st.set_page_config(page_title="Gemini 3 Expert Analyst", page_icon="üèüÔ∏è", layout="wide")

# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É —Å–∏—Å—Ç–µ–º—ã (30.01.2026)
today_date = datetime.now().strftime("%d.%m.%Y")

st.title("üèüÔ∏è –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ò–ò-–ê–Ω–∞–ª–∏—Ç–∏–∫")
st.write(f"–¶–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏ | –°–µ–≥–æ–¥–Ω—è: **{today_date}**")

# --- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å ---
with st.sidebar:
    st.header("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã")
    api_key = st.text_input("–í–≤–µ–¥–∏—Ç–µ Google API Key", type="password")
    st.divider()
    st.markdown("""
    **–ê–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º:**
    - –ú–æ–¥–µ–ª—å: `Gemini 3 Flash Preview`
    - –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: `0.0` (–°—Ç—Ä–æ–≥–æ –ø–æ —Ñ–∞–∫—Ç–∞–º)
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö: `–í–∫–ª—é—á–µ–Ω–∞`
    """)
    if st.button("–°–±—Ä–æ—Å–∏—Ç—å –∫—ç—à"):
        st.rerun()

# --- –í–≤–æ–¥ –º–∞—Ç—á–∞ ---
match_input = st.text_input("–ö–∞–∫–æ–π –º–∞—Ç—á –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º?", placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë–∞—Ä—Å–µ–ª–æ–Ω–∞ - –≠—Å–ø–∞–Ω—å–æ–ª")

if st.button("üöÄ –ü–û–õ–£–ß–ò–¢–¨ –ü–†–û–í–ï–†–ï–ù–ù–´–ô –ü–†–û–ì–ù–û–ó"):
    if not api_key:
        st.error("–û—à–∏–±–∫–∞: –í–≤–µ–¥–∏—Ç–µ –≤–∞—à API Key –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏.")
    elif not match_input:
        st.warning("–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥.")
    else:
        try:
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google AI
            genai.configure(api_key=api_key)
            
            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π
            generation_config = {
                "temperature": 0,
                "top_p": 1,
                "max_output_tokens": 4096,
            }

            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –ø—Ä–æ—Å–∏–ª
            model = genai.GenerativeModel(
                model_name='gemini-3-flash-preview',
                generation_config=generation_config
            )
            
            with st.spinner('–°–≤–µ—Ä—è—é –¥–∞–Ω–Ω—ã–µ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏...'):
                # –£—Å–∏–ª–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –≤—ã–¥—É–º–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
                query = (
                    f"–°–µ–≥–æ–¥–Ω—è {today_date}. –¢—ã ‚Äî —ç–ª–∏—Ç–Ω—ã–π —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç –∏ —Å—Ç—Ä–æ–≥–∏–π —Ñ–∞–∫—Ç—á–µ–∫–µ—Ä. "
                    f"–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ç—á {match_input}. "
                    f"–ü–†–ê–í–ò–õ–ê: "
                    f"1. –°–Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –º–∞—Ç—á–∏ –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫. –ï—Å–ª–∏ –º–∞—Ç—á–∞ –Ω–µ –±—ã–ª–æ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ ‚Äî –Ω–µ –≤—ã–¥—É–º—ã–≤–∞–π –µ–≥–æ! "
                    f"2. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –æ —Ç—Ä–∞–≤–º–∞—Ö –∏ –¥–∏—Å–∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è—Ö –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é. "
                    f"3. –ï—Å–ª–∏ —Ç—ã –Ω–µ —É–≤–µ—Ä–µ–Ω –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –º–∞—Ç—á–∞, –ª—É—á—à–µ –Ω–∞–ø–∏—à–∏ '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö', —á–µ–º –ø—Ä–∏–¥—É–º—ã–≤–∞–π —Å—á–µ—Ç. "
                    f"4. –°—Ñ–æ—Ä–º–∏—Ä—É–π –æ—Ç—á–µ—Ç: "
                    f"- –¢–µ–∫—É—â–∞—è —Ñ–æ—Ä–º–∞ –∏ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏. "
                    f"- –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å (–ü1/X/–ü2) –≤ %. "
                    f"- –ü—Ä–æ–≥–Ω–æ–∑ —Ç–æ—á–Ω–æ–≥–æ —Å—á–µ—Ç–∞. "
                    f"- –°–∞–º–∞—è –Ω–∞–¥–µ–∂–Ω–∞—è —Å—Ç–∞–≤–∫–∞ —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º. "
                    f"–û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ó–∞–±—É–¥—å –ø—Ä–æ 2024 –≥–æ–¥, —Å–µ–π—á–∞—Å 2026-–π."
                )
                
                # –ó–∞–ø—Ä–æ—Å –∫ –º–æ–¥–µ–ª–∏
                response = model.generate_content(query)
                
                # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                st.markdown("---")
                st.success(f"–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å Gemini 3 Flash Preview)")
                st.markdown(response.text)
                
        except Exception as e:
            st.error(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ API: {str(e)}")
            st.info("–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –∫–ª—é—á –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–æ–¥–µ–ª—å 'gemini-3-flash-preview'.")

# --- –ü–æ–¥–≤–∞–ª ---
st.markdown("---")
st.caption("–í–Ω–∏–º–∞–Ω–∏–µ: –ò–ò –º–æ–∂–µ—Ç –æ—à–∏–±–∞—Ç—å—Å—è. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –ø—Ä–∏–Ω—è—Ç–∏–µ–º —Ä–µ—à–µ–Ω–∏–π.")
