import streamlit as st
import google.generativeai as genai
from datetime import datetime

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ---
st.set_page_config(page_title="Gemini 3 Flash Analyst", page_icon="‚öΩ", layout="wide")

# –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
today_date = datetime.now().strftime("%d.%m.%Y")

st.title("‚öΩ –ò–ò-–ê–Ω–∞–ª–∏—Ç–∏–∫: Gemini 3 Flash Preview")
st.write(f"–°–µ–≥–æ–¥–Ω—è: {today_date} | –ê–Ω–∞–ª–∏–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏")

# --- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å ---
with st.sidebar:
    st.header("–ù–∞—Å—Ç—Ä–æ–π–∫–∏")
    api_key = st.text_input("–í–≤–µ–¥–∏—Ç–µ Google API Key", type="password")
    st.divider()
    st.info("–ú–æ–¥–µ–ª—å: Gemini 3 Flash Preview\n–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0")

# --- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ---
match_input = st.text_input("–í–≤–µ–¥–∏—Ç–µ –º–∞—Ç—á (–Ω–∞–ø—Ä–∏–º–µ—Ä: –õ–∏–≤–µ—Ä–ø—É–ª—å - –†–µ–∞–ª –ú–∞–¥—Ä–∏–¥):")

if st.button("üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨ –ê–ù–ê–õ–ò–ó"):
    if not api_key:
        st.error("–û—à–∏–±–∫–∞: –°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏!")
    elif not match_input:
        st.warning("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥.")
    else:
        try:
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API
            genai.configure(api_key=api_key)
            
            # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏
            generation_config = {
                "temperature": 0,
                "top_p": 1,
                "max_output_tokens": 4096,
            }

            # –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∏–º–µ–Ω–Ω–æ 3 Flash Preview
            # –ï—Å–ª–∏ –æ–Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ç–≤–æ–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –æ—à–∏–±–∫—É
            model_name = 'models/gemini-3-flash-preview'
            
            model = genai.GenerativeModel(
                model_name=model_name,
                generation_config=generation_config
            )
            
            with st.spinner(f'Gemini 3 Flash —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ {today_date}...'):
                # –ö–æ—Ä–æ—Ç–∫–∏–π –∏ —á–µ—Ç–∫–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
                query = (
                    f"–°–µ–≥–æ–¥–Ω—è {today_date}. –¢—ã —ç–ª–∏—Ç–Ω—ã–π —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫. "
                    f"–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –º–∞—Ç—á {match_input}. –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–∏—Å–∫, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ "
                    f"–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–∞–≤—ã, —Ç—Ä–∞–≤–º—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–∞–Ω–¥ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –Ω–µ–¥–µ–ª–∏. "
                    f"–í—ã–¥–∞–π: 1) –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ü1/X/–ü2 –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö. 2) –ü—Ä–æ–≥–Ω–æ–∑ —Å—á–µ—Ç–∞. "
                    f"3) –õ—É—á—à—É—é —Å—Ç–∞–≤–∫—É –¥–Ω—è —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º. –ù–µ —É–ø–æ–º–∏–Ω–∞–π 2024 –≥–æ–¥."
                )
                
                response = model.generate_content(query)
                
                st.markdown("---")
                st.success(f"–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω –º–æ–¥–µ–ª—å—é {model_name}")
                st.markdown(response.text)
                
        except Exception as e:
            st.error(f"–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–æ–¥–µ–ª–∏: {str(e)}")
            st.info("–ü–æ–¥—Å–∫–∞–∑–∫–∞: –ï—Å–ª–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 404, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Google AI Studio, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ –≤–∞–º –º–æ–¥–µ–ª—å 'gemini-3-flash-preview' –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ 'gemini-1.5-flash'.")

# --- –§—É—Ç–µ—Ä ---
st.markdown("---")
st.caption("–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –Ω–∞ –±–∞–∑–µ Gemini 3 Flash Preview.")
