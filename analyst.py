import streamlit as st
import google.generativeai as genai
from datetime import datetime

# --- 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ---
st.set_page_config(
    page_title="Gemini 3 Pro Analyst", 
    page_icon="‚öΩ", 
    layout="wide"
)

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
today_date = datetime.now().strftime("%d.%m.%Y")

# –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
st.markdown("""
    <style>
    .main { background-color: #0e1117; }
    .stButton>button { width: 100%; border-radius: 5px; height: 3em; background-color: #ff4b4b; color: white; }
    </style>
    """, unsafe_allow_html=True)

st.title(f"üèÜ –ò–ò-–ê–Ω–∞–ª–∏—Ç–∏–∫ (–í–µ—Ä—Å–∏—è Gemini 3 Flash)")
st.info(f"–°–µ–≥–æ–¥–Ω—è: {today_date} | –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä—è–º–æ–≥–æ –ø–æ–∏—Å–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.")

# --- 2. –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å ---
with st.sidebar:
    st.header("–ù–∞—Å—Ç—Ä–æ–π–∫–∏")
    api_key = st.text_input("–í—Å—Ç–∞–≤—å—Ç–µ Google API Key", type="password")
    st.markdown("---")
    st.write("**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏:**")
    st.write("- **–ú–æ–¥–µ–ª—å:** Gemini 3 Flash")
    st.write("- **–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:** 0 (–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å)")
    st.write("- **–ü–æ–∏—Å–∫:** –í–∫–ª—é—á–µ–Ω")
    st.divider()
    if st.button("–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é"):
        st.rerun()

# --- 3. –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ –≤–≤–æ–¥–∞ ---
col1, col2 = st.columns([2, 1])

with col1:
    match_input = st.text_input(
        "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥ –∏–ª–∏ —Å–æ–±—ã—Ç–∏–µ:", 
        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∞–Ω—á–µ—Å—Ç–µ—Ä –°–∏—Ç–∏ - –õ–∏–≤–µ—Ä–ø—É–ª—å"
    )

with col2:
    sport_type = st.selectbox("–í–∏–¥ —Å–ø–æ—Ä—Ç–∞", ["–§—É—Ç–±–æ–ª", "–ë–∞—Å–∫–µ—Ç–±–æ–ª", "–¢–µ–Ω–Ω–∏—Å", "–•–æ–∫–∫–µ–π"])

# --- 4. –õ–æ–≥–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ ---
if st.button("üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨ –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó"):
    if not api_key:
        st.error("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏!")
    elif not match_input:
        st.warning("–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥.")
    else:
        try:
            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
            genai.configure(api_key=api_key)
            
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (Temperature = 0 –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ñ–∞–Ω—Ç–∞–∑–∏–π)
            generation_config = {
                "temperature": 0,
                "top_p": 0.95,
                "max_output_tokens": 8192,
            }

            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏
            model = genai.GenerativeModel(
                model_name='gemini-3-flash',
                generation_config=generation_config
            )
            
            with st.spinner(f'–ò–ò —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –Ω–æ–≤–æ—Å—Ç–∏, —Å–æ—Å—Ç–∞–≤—ã –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –Ω–∞ {today_date}...'):
                # –ü—Ä–æ–º–ø—Ç-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (System Instruction)
                prompt = f"""
                –¢—ã ‚Äî —ç–ª–∏—Ç–Ω—ã–π —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫ –∏ —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—é.
                –°–µ–≥–æ–¥–Ω—è {today_date}. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–≤–µ—Å—Ç–∏ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –º–∞—Ç—á–∞: {match_input} ({sport_type}).
                
                –î–ï–ô–°–¢–í–£–ô –ü–û –®–ê–ì–ê–ú:
                1. –°–¥–µ–ª–∞–π –ø–æ–∏—Å–∫ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º –Ω–æ–≤–æ—Å—Ç—è–º –æ —Å–æ—Å—Ç–∞–≤–∞—Ö, —Ç—Ä–∞–≤–º–∞—Ö –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç.
                2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ª–∏—á–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∞—Ç—á–µ–π –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã.
                3. –£—á—Ç–∏ –≤–Ω–µ—à–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã: –º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è, –ø–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –∏ —Ç—É—Ä–Ω–∏—Ä–Ω—É—é –º–æ—Ç–∏–≤–∞—Ü–∏—é.
                
                –°–¢–†–£–ö–¢–£–†–ê –û–¢–í–ï–¢–ê (–≤—ã–¥–∞–π –≤ Markdown):
                ## üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç: {match_input}
                
                ### üìù –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä –∏ –Ω–æ–≤–æ—Å—Ç–∏
                (–û–ø–∏—à–∏ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∏ –≤–∞–∂–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –≤ —Å–æ—Å—Ç–∞–≤–∞—Ö)
                
                ###
